# VBA导入工具 - 开发设计文档

## 1. 项目概述

### 1.1 项目名称
VBA导入工具 (VBA Import/Export Tool)

### 1.2 项目目标
开发一个基于PyQt5的桌面应用程序，用于管理Word文档中的VBA代码，实现VBA代码的导入和导出功能。

### 1.3 技术栈
- **GUI框架**: PyQt5
- **Word操作**: python-docx (文档结构) + win32com (VBA工程操作)
- **编程语言**: Python 3.8+

---

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 Word VBA代码导出
- 读取Word文档中的VBA工程
- 将VBA组件分解为多个文件- 支持保存
的VBA组件类型：
  - 标准模块 (Standard Module) - `.bas` 扩展名
  - 类模块 (Class Module) - `.cls` 扩展名
  - 窗体 (UserForm) - `.frm` 扩展名
  - 文档模块 (Document Module) - `.cls` 扩展名

#### 2.1.2 VBA代码导入
- 选择包含VBA代码文件的文件夹
- 将文件夹中的VBA文件导入到Word文档
- 支持选择性导入（勾选要导入的组件）

#### 2.1.3 用户界面功能
- Word文件选择功能（文件浏览器）
- VBA文件夹选择功能（文件夹浏览器）
- 导入确认弹窗
- 导出确认弹窗
- 状态显示和日志输出

### 2.2 用户交互流程

#### 导出流程
1. 用户点击"选择Word文件"按钮
2. 弹出文件选择对话框，选择.docm或.doc文件
3. 选择保存VBA文件的目标文件夹
4. 点击"导出VBA"按钮
5. 弹出确认对话框，显示将要导出的组件列表
6. 用户确认后，执行导出操作
7. 显示导出结果

#### 导入流程
1. 用户点击"选择Word文件"按钮
2. 弹出文件选择对话框，选择.docm文件
3. 选择包含VBA代码的文件夹
4. 软件扫描文件夹，显示可导入的VBA组件列表
5. 点击"导入VBA"按钮
6. 弹出确认对话框，显示将要导入的组件列表
7. 用户确认后，执行导入操作
8. 显示导入结果

---

## 3. UI设计

### 3.1 主窗口布局

```
┌─────────────────────────────────────────────────────────┐
│  VBA导入工具                                    [─][□][×]│
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ Word文件: [________________________] [选择文件] │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ VBA文件夹: [________________________] [选择文件夹]│   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 组件列表:                                         │   │
│  │ ☑ Module1 (标准模块)                              │   │
│  │ ☑ Class1 (类模块)                                 │   │
│  │ ☑ UserForm1 (窗体)                                │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 操作:                                            │   │
│  │ [导出VBA]                      [导入VBA]          │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 日志输出:                                        │   │
│  │ 2024-01-01 10:00:00 - 程序启动                    │   │
│  │ ...                                              │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 3.2 组件说明

| 组件 | 描述 |
|------|------|
| Word文件选择区 | 包含文本框和按钮，用于选择Word文档 |
| VBA文件夹选择区 | 包含文本框和按钮，用于选择VBA代码文件夹 |
| 组件列表 | 显示检测到的VBA组件，支持勾选 |
| 操作按钮 | 导出和导入功能按钮 |
| 日志输出 | 显示操作日志和状态信息 |

### 3.3 确认弹窗设计

```
┌───────────────────────────────────────┐
│         确认操作                        │
├───────────────────────────────────────┤
│                                       │
│  确认要执行以下操作吗？                   │
│                                       │
│  导出组件:                             │
│  ☑ Module1                            │
│  ☑ Class1                             │
│  ☑ UserForm1                          │
│                                       │
│  目标文件夹: C:\VBA_Export             │
│                                       │
│         [确认]        [取消]           │
│                                       │
└───────────────────────────────────────┘
```

---

## 4. 技术实现

### 4.1 项目结构

```
VBA工程/
├── VBA导入工具.py          # 主程序入口
├── ui/
│   └── main_window.py     # 主窗口UI定义
├── core/
│   ├── __init__.py
│   ├── word_handler.py    # Word文件操作
│   └── vba_handler.py     # VBA代码处理
├── utils/
│   ├── __init__.py
│   └── logger.py          # 日志工具
├── requirements.txt       # 依赖文件
└── README.md             # 说明文档
```

### 4.2 核心类设计

#### VBAComponent
```python
class VBAComponent:
    name: str           # 组件名称
    component_type: str # 组件类型 (Module/Class/UserForm/Document)
    code: str           # VBA源代码
    file_ext: str       # 文件扩展名
```

#### WordVBAHandler
```python
class WordVBAHandler:
    def open_document(self, path: str) -> bool
    def close_document(self)
    def get_vba_components(self) -> List[VBAComponent]
    def export_vba(self, folder: str, components: List[VBAComponent]) -> bool
    def import_vba(self, folder: str, components: List[VBAComponent]) -> bool
```

### 4.3 VBA组件类型映射

| 类型 | 扩展名 | 说明 |
|------|--------|------|
| 标准模块 | .bas | 常规VBA代码模块 |
| 类模块 | .cls | VBA类定义 |
| 窗体 | .frm | UserForm窗体 |
| 文档模块 | .cls | 绑定到文档的模块 |

---

## 5. 依赖说明

### 5.1 Python依赖
- PyQt5 >= 5.15.0 - GUI框架
- python-docx >= 0.8.11 - Word文档处理
- pywin32 >= 300 - Windows COM接口（操作Word VBA）

### 5.2 系统要求
- Windows操作系统
- Microsoft Word 2016已安装
- Python 3.8或更高版本

---

## 6. 错误处理

### 6.1 常见错误
1. Word文件不存在或无法打开
2. Word文档不含VBA代码
3. VBA工程被锁定（需要启用宏）
4. 文件夹权限不足
5. Word进程未正确关闭

### 6.2 处理策略
- 详细错误日志记录
- 用户友好的错误提示
- 确保Word进程正确释放

---

## 7. 后续优化（可选）

1. 支持Excel和PowerPoint的VBA导入
2. VBA代码语法高亮
3. 版本控制支持
4. VBA代码比较功能
